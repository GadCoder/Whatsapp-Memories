# ===========================================
# Whatsapp-Memories Configuration
# ===========================================

# -------------------------------------------
# Redis Configuration
# -------------------------------------------
REDIS_HOST=redis
REDIS_PORT=6379

# -------------------------------------------
# PostgreSQL Configuration
# -------------------------------------------
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=memories
POSTGRES_USER=memories
POSTGRES_PASSWORD=your-secure-password-here

# -------------------------------------------
# Embedding Provider Configuration
# -------------------------------------------

# Primary embedding provider to use
# Options: openai, gemini
# Default: openai (proven quality, $0.02/1M tokens)
EMBEDDING_PROVIDER=openai

# Optional fallback provider if primary fails
# Leave empty to disable fallback
# Example: EMBEDDING_FALLBACK_PROVIDER=gemini
# EMBEDDING_FALLBACK_PROVIDER=

# Require embeddings at startup?
# - false: continue in degraded mode if provider is unavailable (recommended for ingestion durability)
# - true: fail startup if no embedding provider can be initialized
EMBEDDINGS_REQUIRED=false

# -------------------------------------------
# OpenAI Configuration (Default Provider)
# -------------------------------------------

# Your OpenAI API key (required if using OpenAI provider)
# Get one at: https://platform.openai.com/api-keys
OPENAI_API_KEY=your-openai-api-key-here

# Embedding model to use
# Options: 
#   - text-embedding-3-small (1536 dims, $0.02/1M tokens) [Recommended]
#   - text-embedding-3-large (3072 dims, $0.13/1M tokens) [Not supported yet - requires schema update]
OPENAI_EMBEDDING_MODEL=text-embedding-3-small

# -------------------------------------------
# Google Gemini Configuration (Alternative Provider)
# -------------------------------------------

# Your Google AI API key (required if using Gemini provider)
# Get one at: https://aistudio.google.com/app/apikey
# Gemini is much cheaper (~$0.001-0.003/1M tokens) but less proven for RAG
# GEMINI_API_KEY=your-gemini-api-key-here

# Embedding model to use
# Options: text-embedding-004 (768 dims, padded to 1536)
# GEMINI_EMBEDDING_MODEL=text-embedding-004

# -------------------------------------------
# Message Filtering Configuration
# -------------------------------------------

# Filter mode: Controls which messages to save
# Options: all, allowlist, blocklist
# - all: Save all messages (default)
# - allowlist: Only save messages from specified contacts
# - blocklist: Save all messages except from specified contacts
FILTER_MODE=all

# Comma-separated list of WhatsApp IDs
# Used with allowlist or blocklist modes
# Example: FILTER_CONTACTS=1234567890@c.us,5551234567@c.us
# FILTER_CONTACTS=

# Validate FILTER_CONTACTS format strictly?
# - false: warn on invalid values and continue
# - true: fail startup when invalid identifiers are configured
FILTER_STRICT_VALIDATION=false

# Group message filtering
# Options: include, exclude, only
# - include: Save both group and direct messages (default)
# - exclude: Only save direct messages (no groups)
# - only: Only save group messages
FILTER_GROUPS=include

# Include broadcast list messages?
# Options: true, false (default: false)
FILTER_BROADCAST=false

# Deduplication window for message IDs (milliseconds)
# Prevents duplicate processing when WhatsApp emits overlapping events
MESSAGE_DEDUPE_WINDOW_MS=600000

# -------------------------------------------
# Retry Configuration
# -------------------------------------------

# Maximum number of retry attempts when publishing to Redis fails
RETRY_MAX_ATTEMPTS=3

# Initial delay between retries (in milliseconds)
RETRY_INITIAL_DELAY=1000

# Maximum delay between retries (in milliseconds)
RETRY_MAX_DELAY=10000

# Backoff multiplier (delay increases by this factor each retry)
RETRY_BACKOFF_MULTIPLIER=2

# -------------------------------------------
# Queue Configuration
# -------------------------------------------

# Maximum number of messages to queue locally if Redis is unavailable
QUEUE_MAX_SIZE=1000

# Interval to attempt flushing the queue (in milliseconds)
# Default: 60000 (1 minute)
QUEUE_FLUSH_INTERVAL=60000

# File path for dead-letter records when messages cannot be delivered
QUEUE_DEAD_LETTER_PATH=/usr/src/app/data/publisher-dead-letter.ndjson

# -------------------------------------------
# Debug Configuration
# -------------------------------------------

# Enable debug logging
# Options: true, false (default: false)
# Set to true during development/testing, false in production
DEBUG=false

# -------------------------------------------
# Puppeteer Configuration (Docker only)
# -------------------------------------------

# Path to Chromium executable (set automatically in Docker)
# PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium
